{
  "permissions": {
    "allow": [
      "Bash(npm run test:coverage:*)",
      "Bash(npx jest:*)",
      "Bash(grep:*)",
      "Bash(git checkout:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\ndocs: add comprehensive database schema & queries analysis\n\nAdds detailed analysis of Firestore database layer covering:\n\n- 18 collections with schema breakdown\n- 120+ queries across 9 service files\n- 5 critical N+1 query patterns identified:\n  * FriendService.getFriends\\(\\) \\(400+ queries for 100 friends\\)\n  * Friend activity ''in'' operator limit \\(silent data loss >10 friends\\)\n  * User search N+1 \\(20+ queries per search\\)\n  * Leaderboard rank calculation \\(collection scans, O\\(n\\) cost\\)\n  * User data search \\(multiple sequential queries\\)\n\n- Missing 8+ critical Firestore composite indexes\n- Denormalization risks in 4+ collections\n- Real-time listener broadcasting all presence data\n- No query result caching implementation\n- Incomplete Firestore security rules\n\nPriority fixes identified:\n1. Batch load friends data \\(99% query reduction\\)\n2. Batch friend activity queries \\(fixes data loss\\)\n3. Add composite indexes \\(10-20x faster queries\\)\n4. Optimize leaderboard rank calculation \\(99.9% reduction\\)\n5. Implement query caching and memoization\n\nCo-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(xargs cat:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\ndocs: add comprehensive performance & monitoring analysis\n\nAdds detailed analysis of performance monitoring system covering:\n\nCore Architecture:\n- 7-component monitoring stack \\(PerformanceProvider, hooks, services, dashboards\\)\n- In-memory metrics collection with 1000-metric limit per system\n- Web Vitals tracking \\(CLS, FID, LCP\\)\n- Network & resource monitoring via fetch interception\n- Component-level render tracking with FPS monitoring\n- Social feature-specific metrics collection\n\nCritical Issues Identified \\(2\\):\n1. Production metrics export disabled \\(commented out code\\)\n   - Lines 72-74 in performanceAnalyzer.ts\n   - Zero production visibility\n2. Memory leak in useBenchmark frame tracking\n   - Frame array grows unbounded during component lifetime\n   - Affects 5 UI components\n\nHigh Priority Issues \\(2\\):\n- Incomplete Web Vitals coverage \\(missing INP, TTFB\\)\n- React Query performance not tracked\n\nMedium Priority Issues \\(6\\):\n- Fetch monkeypatching global scope\n- Component metrics all record zero values\n- Dynamic import on every navigation\n- Redundant monitoring systems \\(3x memory overhead\\)\n- No error differentiation in metrics\n- No metrics sampling or rate limiting\n\nRecommendations:\nPriority 1 \\(Immediate\\):\n- Enable production metrics export\n- Fix frame tracking memory leak  \n- Consolidate monitoring systems\n\nPriority 2 \\(Week 1\\):\n- Implement React Query middleware\n- Add INP & TTFB tracking\n- Fix component metrics to record durations\n\nPriority 3 \\(Week 2\\):\n- Optimize fetch monitoring \\(remove monkeypatching\\)\n- Implement metrics sampling\n- Cache web-vitals import\n\nTotal Issues: 10 major + 2 architectural\n\nCo-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(find:*)",
      "Bash(bd create:*)",
      "Bash(bd dep add:*)",
      "Bash(__NEW_LINE_e8ab04db0497ae70__ bd create --title=\"[1.2] Remove or gate test endpoints \\(/api/auth/test-*\\)\" --type=bug --priority=0 --description=\"CRITICAL SECURITY: Test endpoints like /api/auth/test-login, /api/auth/test-logout exposed in production. Remove or gate to dev only.\")",
      "Bash(__NEW_LINE_e8ab04db0497ae70__ bd create --title=\"[1.3] Remove ignoreBuildErrors: true from next.config.js\" --type=bug --priority=0 --description=\"CRITICAL: Prevents TypeScript errors from failing builds. Allows broken code to ship. Must enable strict type checking.\")",
      "Bash(__NEW_LINE_e8ab04db0497ae70__ bd create --title=\"[1.4] Add type checking to CI pipeline\" --type=task --priority=0 --description=\"Add ''tsc --noEmit'' to pre-deploy CI steps. Catch type errors before shipping code.\")",
      "Bash(__NEW_LINE_e8ab04db0497ae70__ bd create --title=\"[1.5] Remove or gate mock data fallback in production\" --type=bug --priority=0 --description=\"Silent fallback to mock data in production. Should fail loudly if real data unavailable, not silently use stale data.\")",
      "Bash(__NEW_LINE_3a64befead9401df__ bd create --title=\"[2.2] Apply response wrapper to all API routes\" --type=task --priority=1 --description=\"Systematically apply standardized wrapper to all endpoints: /api/auth/*, /api/user/*, /api/quiz/*, /api/daily-quiz/*. Track completion per endpoint.\")",
      "Bash(__NEW_LINE_3a64befead9401df__ bd create --title=\"[2.3] Implement centralized error handling middleware\" --type=feature --priority=1 --description=\"Create middleware layer to catch and format all errors consistently. Handle auth errors, validation errors, server errors uniformly.\")",
      "Bash(__NEW_LINE_3a64befead9401df__ bd create --title=\"[2.4] Add request ID tracking to all responses\" --type=task --priority=1 --description=\"Add unique requestId to response meta for tracing. Enables debugging of request flows across logs.\")",
      "Bash(__NEW_LINE_db4adbfd1b71ba16__ bd create --title=\"[3.2] Choose and plan consolidation to single auth system\" --type=task --priority=1 --description=\"Decide: NextAuth \\(recommended\\) vs Firebase Auth. Plan migration path. Document differences in property names \\(uid vs id, etc\\).\")",
      "Bash(__NEW_LINE_db4adbfd1b71ba16__ bd create --title=\"[3.3] Migrate API routes to chosen auth system\" --type=task --priority=1 --description=\"Systematically update all API routes to use single auth system. File: app/api/*/route.ts files. Track per endpoint.\")",
      "Bash(__NEW_LINE_db4adbfd1b71ba16__ bd create --title=\"[3.4] Migrate client hooks to chosen auth system\" --type=task --priority=1 --description=\"Update useAuth, auth state management hooks to use single system. File: app/hooks/useAuth.ts and related.\")",
      "Bash(__NEW_LINE_db4adbfd1b71ba16__ bd create --title=\"[3.5] Remove deprecated auth system completely\" --type=task --priority=1 --description=\"Delete Firebase Auth code/imports if NextAuth chosen \\(or vice versa\\). Remove from dependencies, env vars, providers.\")",
      "Bash(__NEW_LINE_03b9e6ceb9a1999c__ bd create --title=\"[4.2] Centralize React Query configuration\" --type=task --priority=1 --description=\"Standardize staleTime, gcTime, retry settings across all query hooks. Currently inconsistent: useOptimizedQuery vs useDailyQuiz vs useLeaderboard use different settings. Create queryClient config with sensible defaults.\")",
      "Bash(__NEW_LINE_03b9e6ceb9a1999c__ bd create --title=\"[4.3] Remove localStorage cache bypass\" --type=bug --priority=1 --description=\"Stop using localStorage as fallback data source. React Query is source of truth. Remove: app/hooks/useLocalStorage*, localStorage fallback patterns.\")",
      "Bash(__NEW_LINE_03b9e6ceb9a1999c__ bd create --title=\"[4.4] Consolidate real-time updates into React Query\" --type=task --priority=1 --description=\"Replace Firebase listeners with React Query subscriptions. Remove duplicate update mechanisms. Single source of truth for all state.\")",
      "Bash(__NEW_LINE_03b9e6ceb9a1999c__ bd create --title=\"[4.5] Remove mock data from production\" --type=bug --priority=1 --description=\"Remove all mock data that''s accessible in production builds. Keep only in test/dev environments. Audit app/lib/mockData* and related.\")",
      "Bash(__NEW_LINE_da5b0192d20e748c__ bd create --title=\"[5.2] Enable linting enforcement in CI\" --type=task --priority=2 --description=\"Add eslint to CI pipeline. Fail builds on lint violations. Currently linting may not be enforced.\")",
      "Bash(__NEW_LINE_da5b0192d20e748c__ bd create --title=\"[5.3] Add bundle size monitoring\" --type=task --priority=2 --description=\"Track bundle size in CI. Alert on significant increases. Prevents performance regressions.\")",
      "Bash(__NEW_LINE_da5b0192d20e748c__ bd create --title=\"[5.4] Pin Node.js version\" --type=task --priority=2 --description=\"Add .nvmrc file with pinned Node version. Ensures reproducible builds across environments.\")",
      "Bash(__NEW_LINE_da5b0192d20e748c__ bd create --title=\"[5.5] Add E2E tests to CI pipeline\" --type=task --priority=2 --description=\"Run Playwright E2E tests in CI. Catch integration issues before production.\")",
      "Bash(__NEW_LINE_668a89afccf9cfbc__ bd create --title=\"[6.2] Fix performance monitoring \\(remove monkeypatching\\)\" --type=task --priority=2 --description=\"Remove monkeypatching of network calls for performance monitoring. Use proper API instrumentation instead. Files: app/lib/performance*\")",
      "Bash(__NEW_LINE_668a89afccf9cfbc__ bd create --title=\"[6.3] Fix over-mocking in tests\" --type=task --priority=2 --description=\"Remove excessive mocks that prevent testing real behavior. Mock external deps only, not app code. Affects: test files using jest.mock excessively.\")",
      "Bash(__NEW_LINE_668a89afccf9cfbc__ bd create --title=\"[6.4] Expand E2E test coverage\" --type=task --priority=2 --description=\"Increase E2E test coverage from ~5% to 20%+. Focus on critical user journeys \\(login, quiz submission, leaderboard\\).\")",
      "Bash(__NEW_LINE_2e27e7ece79eeab7__ bd create --title=\"[7.2] Document decisions and patterns established\" --type=task --priority=3 --description=\"Create decision log documenting: auth system choice, state management patterns, API response standard, etc. File: docs/DECISIONS.md\")",
      "Bash(__NEW_LINE_2e27e7ece79eeab7__ bd create --title=\"[7.3] Create runbooks for common operations\" --type=task --priority=3 --description=\"Document: how to add new API endpoint \\(with standard response\\), how to add new data query, how to authenticate new route, etc.\")",
      "Bash(__NEW_LINE_2e27e7ece79eeab7__ bd create --title=\"[7.4] Track and report on improvement metrics\" --type=task --priority=3 --description=\"Measure and report: type check % \\(target 100%\\), test pass % \\(95%+\\), E2E coverage \\(20%+\\), bundle size, build time, Lighthouse score.\")",
      "Bash(bd stats:*)",
      "Bash(bd ready:*)",
      "Bash(bd list:*)",
      "Bash(bd close:*)",
      "Bash(bd sync:*)",
      "Bash(bd update:*)",
      "Bash(ls:*)",
      "Bash(npm run type-check:*)",
      "Bash(git push)",
      "Bash(npm test:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Remove hard-coded test tokens from middleware\n\nCRITICAL FIX: Removed mock token/session verification from production middleware:\n- Removed string comparison against ''expired-token'' in authMiddleware\n- Removed string comparison against ''expired-session'' in main middleware\n- Updated to use proper NextAuth JWT verification via cookies\n- Added documentation clarifying that NextAuth handles token validation\n\nSecurity impact: Test code is no longer in production. Proper JWT validation\nis handled by NextAuth''s built-in mechanisms in route handlers using auth\\(\\).\n\nTests: Security/middleware tests pass \\(11/11\\)\n\nCo-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(done)",
      "Bash(git commit:*)"
    ]
  }
}
